<?phpadd_filter('gform_form_settings', 'gfgss_form_setting', 50, 2);function gfgss_form_setting($settings, $form) {   //add   $gfgss_enabled='';   $gfgss_disabled = '';   $gfgss_display = '';   if(rgar($form, 'gfgss_enabled')){   		$gfgss_enabled = ' checked';   }else{	   $gfgss_disabled = ' checked';	   $gfgss_display = ' style="display:none;"';   }    $settings['Form Options']['gfgss_enabled']= '<tr>            <th><label for="gfgss_enabled_label">Save Data To Google Spreadsheet?</label></th>            <td><input type="radio"'.$gfgss_enabled.' value="1" name="gfgss_enabled" onclick="javascript: jQuery(\'.gfgss_enabled\').show();">&nbsp;Yes&nbsp;&nbsp;<input type="radio"'.$gfgss_disabled.' value="0" name="gfgss_enabled" onclick="javascript: jQuery(\'.gfgss_enabled\').hide();">&nbsp;No</td>        </tr>';     $settings['Form Options']['gfgss_spreadsheet_name']= '<tr class="gfgss_enabled"'.$gfgss_display.'>            <th><label for="gfgss_spreadsheet_name_label">Spreadsheet Name</label></th>            <td><input value="' . rgar($form, 'gfgss_spreadsheet_name') . '" name="gfgss_spreadsheet_name" class="fieldwidth-3"></td>        </tr>';     /*	$settings['Form Options']['gfgss_google_user_name']= '<tr class="gfgss_enabled"'.$gfgss_display.'>            <th><label for="gfgss_google_user_name_label">Google User Name</label></th>            <td><input value="' . rgar($form, 'gfgss_google_user_name') . '" name="gfgss_google_user_name" class="fieldwidth-3"></td>        </tr>';	$settings['Form Options']['gfgss_google_user_pass']= '<tr class="gfgss_enabled"'.$gfgss_display.'>            <th><label for="gfgss_google_user_pass_label">Google User Password</label></th>            <td><input value="' . rgar($form, 'gfgss_google_user_pass') . '" name="gfgss_google_user_pass" class="fieldwidth-3"></td>        </tr>';     */      return $settings;}add_filter('gform_pre_form_settings_save', 'save_gfgss_form_setting');function save_gfgss_form_setting($form) {    $form['gfgss_enabled'] = rgpost('gfgss_enabled');	$form['gfgss_spreadsheet_name'] = rgpost('gfgss_spreadsheet_name');	$form['gfgss_google_user_name'] = rgpost('gfgss_google_user_name');	$form['gfgss_google_user_pass'] = rgpost('gfgss_google_user_pass');	    return $form;}add_action("gform_after_submission", "gfgss_set_contents_to_google", 10, 2);function gfgss_set_contents_to_google($entry, $form){	$data=array();        	foreach($form['fields'] as $field){            if(is_array($field['inputs'])) {                foreach( $field['inputs'] as $field_options ) {                    $field_id = (string)$field_options['id'];                                        if($entry[$field_id]!=""){                        if($field['adminLabel'] != "" ) {                            $data[$field['adminLabel']] = ($data[$field['adminLabel']]=="") ? $entry[$field_id]:$data[$field['adminLabel']].", ".$entry[$field_id];                        }elseif($field['label'] != '' ){                            $data[$field['label']] = ($data[$field['label']]=="") ? $entry[$field_id]:$data[$field['label']].", ".$entry[$field_id];                        }else{                            $data[$field_options['label']] = ($data[$field_options['label']]=="") ? $entry[$field_id]:$data[$field_options['label']].", ".$entry[$field_id];                        }                    }                }            }            $field_id = $field['id'];            if($entry[$field_id]!=""){                if($field['adminLabel'] != "" ) {                    $data[$field['adminLabel']] = $entry[$field_id];                }else{                    $data[$field['label']] = $entry[$field_id];                }            }	}        	//$user = $form['gfgss_google_user_name'];	//$pass = $form['gfgss_google_user_pass'];	$sheet = $form['gfgss_spreadsheet_name'];                $client_id = $form['gfgc_service_client_id'];        $client_email = $form['gfgc_service_account_name'];        $key_file_location = $form['gfgc_service_private_key_path'];        	$data = apply_filters('gfgss_before_add_spreadsheet_row', $data);	                gfgss_insert_row($client_id,$client_email,$key_file_location,$sheet,$data);}function gfgss_insert_row($client_id="",$client_email="",$key_file_location="",$sheet="",$data=array()){	        if($client_id=="" || $client_email=="" || $key_file_location=="" || $sheet=="" || sizeof($data)==0){            return false;	}                $org_inc_path = ini_get("include_path");        ini_set("include_path", GFGSS_PLUGIN_PATH.'includes/');                require_once( GFGSS_PLUGIN_PATH.'includes/vendor/autoload.php' );        $row = array();        foreach( $data as $k=>$v ) {            $key = strtolower( str_replace( array( " ", "'" , ",", "?", "&" ), "", $k ) );               $row[$key] = $v;        }                $G_CLIENT_ID = $client_id;         $G_CLIENT_EMAIL = $client_email;         $G_CLIENT_KEY_PATH = $key_file_location;         $G_CLIENT_KEY_PW = 'notasecret';                    // connect to Google, boilerplate code...        $obj_client_auth = new Google_Client ();        $obj_client_auth->setApplicationName ('CPU Storage Sign Ups');        $obj_client_auth->setClientId ($G_CLIENT_ID);        $obj_client_auth->setAssertionCredentials (new Google_Auth_AssertionCredentials(            $G_CLIENT_EMAIL,             array('https://spreadsheets.google.com/feeds','https://docs.google.com/feeds'),             file_get_contents ($G_CLIENT_KEY_PATH),             $G_CLIENT_KEY_PW        ));        $obj_client_auth->getAuth()->refreshTokenWithAssertion();        $obj_token  = json_decode($obj_client_auth->getAccessToken());        $accessToken = $obj_token->access_token;        $serviceRequest = new Google\Spreadsheet\DefaultServiceRequest($accessToken);        Google\Spreadsheet\ServiceRequestFactory::setInstance($serviceRequest);        $spreadsheetService = new Google\Spreadsheet\SpreadsheetService();        $spreadsheetFeed = $spreadsheetService->getSpreadsheets();        $spreadsheet = $spreadsheetFeed->getByTitle( $sheet );                $worksheetFeed = $spreadsheet->getWorksheets();                // we want Fixtures        $worksheet = $worksheetFeed->getByTitle('Sheet1');        $listFeed = $worksheet->getListFeed();                if( $listFeed->insert($row) ) {            ini_set("include_path", $org_inc_path);            return true;        }else{            ini_set("include_path", $org_inc_path);            return false;         }                 ini_set("include_path", $org_inc_path);        }?>